# Build uboot

* Get uboot source code

```bash
git clone git://git.denx.de/u-boot.git
```

* According to your compiler

```bash
# Use the compiler generated by yourself
export CROSS_COMPILE=arm-unknown-linux-gnueabihf-
# Use the compiler from other vendors
export CROSS_COMPILE=arm-none-linux-gnueabi-
# Use the compiler from Ubuntu
export CROSS_COMPILE=arm-linux-gnueabi-
```

* Compile

```bash
cd u-boot
# Setup config
make ARCH=arm vexpress_ca9x4_defconfig
# Build
make ARCH=arm
```

* Test with qemu
  - If you want to stop, press ctrl+a, and then x.

```bash
qemu-system-arm -M vexpress-a9 -m 256 -kernel u-boot --nographic
```

# Boot from uboot and run Linux

* Settings TFTP

```bash
sudo apt install tftp-hpa tftpd-hpa
# Check the path of TFTP_DIRECTORY in "/etc/default/tftpd-hpa", and then copy kernel image
sudo cp linux/arch/arm/boot/zImage /var/lib/tftpboot
sudo systemctl start tftpd-hpa.service
```

* Test with TFTP

```bash
tftp localhost
tftp> get zImage
tftp> quit
ls zImage
```

* Install TUN/TAP network

```bash
sudo apt install bridge-utils uml-utilities
```

* Boot from uboot

```bash
qemu-system-arm -M vexpress-a9 -m 512 --nographic -net nic -net tap,ifname=tap0,script=no -sd sdcard.ext3 -kernel u-boot/u-boot
```
